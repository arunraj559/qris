<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard Selisih QRIS TVTOTO - Upgraded</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #f8f9fa;
    color: #1a1a1a;
    transition: all 0.3s ease;
    position: relative;
  }
  
  body.dark {
    background: #0f0f0f;
    color: #f5f5f5;
  }

  .watermark {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12rem;
    font-weight: 800;
    color: rgba(0, 0, 0, 0.02);
    letter-spacing: 20px;
    pointer-events: none;
    user-select: none;
    z-index: 0;
  }
  
  body.dark .watermark {
    color: rgba(255, 255, 255, 0.02);
  }

  .container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 20px;
    position: relative;
    z-index: 1;
  }

  header {
    background: white;
    border-bottom: 1px solid #e5e5e5;
    padding: 20px;
    margin: -20px -20px 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(10px);
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  
  body.dark header {
    background: #1a1a1a;
    border-bottom-color: #2a2a2a;
  }

  h1 {
    font-size: 1.75rem;
    font-weight: 700;
    color: #d97706;
    margin: 0;
  }
  
  body.dark h1 {
    color: #fbbf24;
  }

  .subtitle {
    font-size: 0.875rem;
    color: #6b7280;
    margin-top: 4px;
  }

  .header-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  button {
    padding: 10px 18px;
    border: none;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    font-family: inherit;
    display: inline-flex;
    align-items: center;
    gap: 8px;
  }

  button:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  button:active {
    transform: translateY(0);
  }

  .btn-primary {
    background: linear-gradient(135deg, #d97706, #f59e0b);
    color: white;
  }

  .btn-outline {
    background: transparent;
    border: 1px solid #d1d5db;
    color: #374151;
  }
  
  body.dark .btn-outline {
    border-color: #374151;
    color: #d1d5db;
  }

  .btn-icon {
    padding: 10px;
    background: transparent;
    border: 1px solid #d1d5db;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  body.dark .btn-icon {
    border-color: #374151;
  }

  .card {
    background: white;
    border: 1px solid #e5e5e5;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    transition: all 0.2s;
  }
  
  body.dark .card {
    background: #1a1a1a;
    border-color: #2a2a2a;
  }

  .card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .stat-card {
    background: white;
    border: 1px solid #e5e5e5;
    border-radius: 12px;
    padding: 20px;
    transition: all 0.2s;
  }
  
  body.dark .stat-card {
    background: #1a1a1a;
    border-color: #2a2a2a;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
  }

  .stat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .stat-title {
    font-size: 0.875rem;
    color: #6b7280;
    font-weight: 500;
  }

  .stat-value {
    font-size: 1.875rem;
    font-weight: 700;
    font-family: 'JetBrains Mono', monospace;
  }

  .stat-subtitle {
    font-size: 0.75rem;
    color: #9ca3af;
    margin-top: 4px;
  }

  .input-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 8px;
    color: #374151;
  }
  
  body.dark label {
    color: #d1d5db;
  }

  textarea, input, select {
    width: 100%;
    padding: 12px;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 0.875rem;
    font-family: inherit;
    background: white;
    color: #1a1a1a;
    transition: all 0.2s;
  }
  
  body.dark textarea,
  body.dark input,
  body.dark select {
    background: #0f0f0f;
    border-color: #374151;
    color: #f5f5f5;
  }

  textarea {
    font-family: 'JetBrains Mono', monospace;
    resize: vertical;
    min-height: 150px;
  }

  input:focus, textarea:focus, select:focus {
    outline: none;
    border-color: #d97706;
    box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
  }

  .filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  }
  
  body.dark table {
    background: #1a1a1a;
  }

  th, td {
    padding: 14px;
    text-align: left;
    border-bottom: 1px solid #e5e5e5;
  }
  
  body.dark th,
  body.dark td {
    border-bottom-color: #2a2a2a;
  }

  th {
    background: #f9fafb;
    font-weight: 600;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: #6b7280;
  }
  
  body.dark th {
    background: #0f0f0f;
    color: #9ca3af;
  }

  td {
    font-size: 0.875rem;
  }

  .mono {
    font-family: 'JetBrains Mono', monospace;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    white-space: nowrap;
  }

  .badge-success {
    background: #d1fae5;
    color: #065f46;
  }
  
  body.dark .badge-success {
    background: #064e3b;
    color: #6ee7b7;
  }

  .badge-warning {
    background: #fed7aa;
    color: #92400e;
  }
  
  body.dark .badge-warning {
    background: #78350f;
    color: #fcd34d;
  }

  .badge-error {
    background: #fee2e2;
    color: #991b1b;
  }
  
  body.dark .badge-error {
    background: #7f1d1d;
    color: #fca5a5;
  }

  .alert {
    padding: 16px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: flex;
    gap: 12px;
  }

  .alert-success {
    background: #d1fae5;
    border: 1px solid #a7f3d0;
    color: #065f46;
  }
  
  body.dark .alert-success {
    background: #064e3b;
    border-color: #065f46;
    color: #6ee7b7;
  }

  .alert-error {
    background: #fee2e2;
    border: 1px solid #fecaca;
    color: #991b1b;
  }
  
  body.dark .alert-error {
    background: #7f1d1d;
    border-color: #991b1b;
    color: #fca5a5;
  }

  .hidden {
    display: none !important;
  }

  .text-center {
    text-align: center;
  }

  .text-right {
    text-align: right;
  }

  .mt-1 { margin-top: 4px; }
  .mt-2 { margin-top: 8px; }
  .mb-2 { margin-bottom: 8px; }
  .mb-4 { margin-bottom: 16px; }

  @media (max-width: 1000px) {
    .stats-grid {
      grid-template-columns: 1fr;
    }
    
    .filter-grid {
      grid-template-columns: 1fr;
    }
    
    table {
      font-size: 0.75rem;
    }
    
    th, td {
      padding: 10px;
    }
  }
</style>
</head>
<body>
<div class="watermark">SMB</div>

<header>
  <div>
    <h1>ùêÉùêöùê¨ùê°ùêõùê®ùêöùê´ùêù ùêíùêûùê•ùê¢ùê¨ùê¢ùê° ùêñùêÆùê§ùê®ùêßùê†</h1>
    <div class="subtitle">Monitoring & Rekonsiliasi Transaksi</div>
  </div>
  <div class="header-actions">
    <button class="btn-outline" onclick="exportCSV()" id="btnCSV" style="display:none">
      üìÑ Export CSV
    </button>
    <button class="btn-outline" onclick="exportPDF()" id="btnPDF" style="display:none">
      üìë Export PDF
    </button>
    <button class="btn-icon" onclick="toggleTheme()" title="Toggle Dark Mode">
      <span id="themeIcon">üåô</span>
    </button>
  </div>
</header>

<div class="container">
  <div class="input-grid">
    <div class="card">
      <label>Data Admin</label>
      <textarea id="adminData" placeholder="Masukkan data admin (format: OrderID Nominal)&#10;Contoh: Mineral001 160000">Mineral001 160000
Mineral002 175000
Mineral004 200000</textarea>
      <div class="stat-subtitle mt-1">Format: OrderID Nominal (pisahkan dengan spasi)</div>
    </div>

    <div class="card">
      <label>Data QRIS</label>
      <textarea id="qrisData" placeholder="Masukkan data QRIS (format: OrderID Nominal)&#10;Contoh: Mineral002 175000">Mineral001 160000
Mineral003 180000
Mineral004 200000</textarea>
      <div class="stat-subtitle mt-1">Format: OrderID Nominal (pisahkan dengan spasi)</div>
    </div>
  </div>

  <div class="text-center mb-4">
    <button class="btn-primary" onclick="generateDashboard()">
      ‚ú® Tampilkan Dashboard
    </button>
  </div>

  <div id="dashboardContent" class="hidden">
    <div class="stats-grid" id="statsGrid"></div>
    
    <div id="alertSection"></div>

    <div class="card">
      <canvas id="statusChart" height="80"></canvas>
    </div>

    <div class="card">
      <h2 class="mb-2" style="font-size: 1.25rem; font-weight: 600;">Filter & Pencarian</h2>
      <div class="filter-grid">
        <div>
          <label>Cari Order ID</label>
          <input type="search" id="searchOrderId" placeholder="Ketik Order ID..." oninput="applyFilters()">
        </div>
        <div>
          <label>Nominal Min (Rp)</label>
          <input type="number" id="minNominal" placeholder="Minimum" class="mono" oninput="applyFilters()">
        </div>
        <div>
          <label>Nominal Max (Rp)</label>
          <input type="number" id="maxNominal" placeholder="Maximum" class="mono" oninput="applyFilters()">
        </div>
        <div>
          <label>Filter Status</label>
          <select id="statusFilter" onchange="applyFilters()">
            <option value="all">Semua Status</option>
            <option value="KLOP">KLOP</option>
            <option value="BEDA">BEDA</option>
            <option value="HILANG DI QRIS">HILANG DI QRIS</option>
            <option value="HILANG DI ADMIN">HILANG DI ADMIN</option>
          </select>
        </div>
      </div>
    </div>

    <div class="card">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
        <h2 style="font-size: 1.25rem; font-weight: 600;">Data Transaksi (<span id="totalRows">0</span>)</h2>
        <div class="stat-subtitle">Total Selisih: <span id="totalSelisihDisplay" class="mono">Rp 0</span></div>
      </div>
      <div id="tableContainer"></div>
    </div>
  </div>
</div>

<script>
let chartInstance = null;
let dashboardData = [];
let isDark = false;

function toProperCase(text) {
  if (!text) return text;
  return text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
}

function formatCurrency(amount) {
  return new Intl.NumberFormat('id-ID', {
    style: 'currency',
    currency: 'IDR',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(amount);
}

function parseDataInput(text) {
  return text.trim().split('\n').filter(line => line.trim()).map(line => {
    const parts = line.trim().split(/\s+/);
    const orderId = parts[0].toUpperCase();
    const amount = parseFloat(parts.slice(1).join('').replace(/[^0-9.]/g, '')) || 0;
    return { orderId, amount };
  });
}

function toggleTheme() {
  isDark = !isDark;
  document.body.classList.toggle('dark', isDark);
  document.getElementById('themeIcon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
}

function initTheme() {
  const hour = new Date().getHours();
  isDark = hour < 6 || hour >= 18;
  document.body.classList.toggle('dark', isDark);
  document.getElementById('themeIcon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
}

function generateDashboard() {
  const adminEntries = parseDataInput(document.getElementById('adminData').value);
  const qrisEntries = parseDataInput(document.getElementById('qrisData').value);

  const adminMap = new Map(adminEntries.map(e => [e.orderId, e.amount]));
  const qrisMap = new Map(qrisEntries.map(e => [e.orderId, e.amount]));

  const allOrderIds = new Set([...adminMap.keys(), ...qrisMap.keys()]);

  dashboardData = [];
  allOrderIds.forEach(orderId => {
    const adminAmount = adminMap.get(orderId) ?? null;
    const qrisAmount = qrisMap.get(orderId) ?? null;

    let status, selisih = null;

    if (adminAmount !== null && qrisAmount !== null) {
      selisih = adminAmount - qrisAmount;
      status = adminAmount === qrisAmount ? 'KLOP' : 'BEDA';
    } else if (adminAmount !== null) {
      status = 'HILANG DI QRIS';
    } else {
      status = 'HILANG DI ADMIN';
    }

    dashboardData.push({ orderId, adminAmount, qrisAmount, selisih, status });
  });

  renderDashboard(qrisEntries);
}

function renderDashboard(qrisEntries) {
  const klop = dashboardData.filter(e => e.status === 'KLOP').length;
  const beda = dashboardData.filter(e => e.status === 'BEDA').length;
  const hilangQris = dashboardData.filter(e => e.status === 'HILANG DI QRIS').length;
  const hilangAdmin = dashboardData.filter(e => e.status === 'HILANG DI ADMIN').length;

  const totalPendapatan = qrisEntries.reduce((sum, e) => sum + e.amount, 0);
  const biayaQris = totalPendapatan * 0.012;

  const totalSelisih = dashboardData.reduce((sum, e) => {
    if (e.status === 'BEDA' && e.selisih !== null) return sum + Math.abs(e.selisih);
    if (e.status === 'HILANG DI QRIS' && e.adminAmount !== null) return sum + e.adminAmount;
    if (e.status === 'HILANG DI ADMIN' && e.qrisAmount !== null) return sum + e.qrisAmount;
    return sum;
  }, 0);

  const hasLargeDiscrepancy = dashboardData.some(e => 
    (e.selisih !== null && Math.abs(e.selisih) > 10000) || e.status.includes('HILANG')
  );

  const missingInQris = dashboardData.filter(e => e.status === 'HILANG DI QRIS').map(e => toProperCase(e.orderId));
  const missingInAdmin = dashboardData.filter(e => e.status === 'HILANG DI ADMIN').map(e => toProperCase(e.orderId));

  document.getElementById('statsGrid').innerHTML = `
    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-title">Total Klop</span>
        <span style="font-size: 1.5rem;">‚úÖ</span>
      </div>
      <div class="stat-value" style="color: #059669;">${klop}</div>
      <div class="stat-subtitle">Data cocok sempurna</div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-title">Total Beda</span>
        <span style="font-size: 1.5rem;">‚ö†Ô∏è</span>
      </div>
      <div class="stat-value" style="color: #ea580c;">${beda}</div>
      <div class="stat-subtitle">Selisih terdeteksi</div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-title">Total Hilang</span>
        <span style="font-size: 1.5rem;">‚ùå</span>
      </div>
      <div class="stat-value" style="color: #dc2626;">${hilangQris + hilangAdmin}</div>
      <div class="stat-subtitle">QRIS: ${hilangQris} | Admin: ${hilangAdmin}</div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <span class="stat-title">Total Pendapatan</span>
        <span style="font-size: 1.5rem;">üí∞</span>
      </div>
      <div class="stat-value" style="color: #d97706;">${formatCurrency(totalPendapatan)}</div>
      <div class="stat-subtitle">Biaya QRIS: ${formatCurrency(biayaQris)}</div>
    </div>
  `;

  let alertHTML = '';
  if (missingInQris.length === 0 && missingInAdmin.length === 0 && !hasLargeDiscrepancy) {
    alertHTML = `
      <div class="alert alert-success">
        <span style="font-size: 1.5rem;">‚úÖ</span>
        <div>
          <strong>Semua Data Lengkap</strong>
          <div class="stat-subtitle">Tidak ada data yang hilang atau selisih besar terdeteksi.</div>
        </div>
      </div>
    `;
  } else {
    if (hasLargeDiscrepancy) {
      alertHTML += `
        <div class="alert alert-error">
          <span style="font-size: 1.5rem;">‚ö†Ô∏è</span>
          <div>
            <strong>Selisih Besar Terdeteksi</strong>
            <div class="stat-subtitle">Beberapa transaksi memiliki selisih lebih dari Rp 10.000. Mohon cek ulang data.</div>
          </div>
        </div>
      `;
    }
    if (missingInQris.length > 0) {
      alertHTML += `
        <div class="alert alert-error">
          <span style="font-size: 1.5rem;">‚ùå</span>
          <div>
            <strong>Data Hilang di QRIS (${missingInQris.length})</strong>
            <div class="mt-2">
              ${missingInQris.slice(0, 10).map(id => `<span class="badge badge-error">${id}</span>`).join(' ')}
              ${missingInQris.length > 10 ? `<span class="badge" style="background:#e5e5e5;color:#666;">+${missingInQris.length - 10} lainnya</span>` : ''}
            </div>
          </div>
        </div>
      `;
    }
    if (missingInAdmin.length > 0) {
      alertHTML += `
        <div class="alert alert-error">
          <span style="font-size: 1.5rem;">‚ùå</span>
          <div>
            <strong>Data Hilang di Admin (${missingInAdmin.length})</strong>
            <div class="mt-2">
              ${missingInAdmin.slice(0, 10).map(id => `<span class="badge badge-error">${id}</span>`).join(' ')}
              ${missingInAdmin.length > 10 ? `<span class="badge" style="background:#e5e5e5;color:#666;">+${missingInAdmin.length - 10} lainnya</span>` : ''}
            </div>
          </div>
        </div>
      `;
    }
  }
  document.getElementById('alertSection').innerHTML = alertHTML;

  renderChart(klop, beda, hilangQris, hilangAdmin);
  
  document.getElementById('dashboardContent').classList.remove('hidden');
  document.getElementById('btnCSV').style.display = 'inline-flex';
  document.getElementById('btnPDF').style.display = 'inline-flex';
  
  applyFilters();
}

function renderChart(klop, beda, hilangQris, hilangAdmin) {
  const ctx = document.getElementById('statusChart').getContext('2d');
  
  if (chartInstance) {
    chartInstance.destroy();
  }

  chartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['KLOP', 'BEDA', 'HILANG DI QRIS', 'HILANG DI ADMIN'],
      datasets: [{
        label: 'Jumlah Transaksi',
        data: [klop, beda, hilangQris, hilangAdmin],
        backgroundColor: [
          'rgba(5, 150, 105, 0.8)',
          'rgba(234, 88, 12, 0.8)',
          'rgba(220, 38, 38, 0.8)',
          'rgba(220, 38, 38, 0.8)',
        ],
        borderColor: [
          'rgb(5, 150, 105)',
          'rgb(234, 88, 12)',
          'rgb(220, 38, 38)',
          'rgb(220, 38, 38)',
        ],
        borderWidth: 2,
      }],
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: { display: false },
        tooltip: { enabled: true },
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { precision: 0 },
        },
      },
    },
  });
}

function applyFilters() {
  const searchTerm = document.getElementById('searchOrderId').value.toUpperCase();
  const minNom = parseFloat(document.getElementById('minNominal').value) || null;
  const maxNom = parseFloat(document.getElementById('maxNominal').value) || null;
  const statusFilter = document.getElementById('statusFilter').value;

  const filtered = dashboardData.filter(entry => {
    if (searchTerm && !entry.orderId.includes(searchTerm)) return false;
    if (statusFilter !== 'all' && entry.status !== statusFilter) return false;
    
    const amount = entry.adminAmount ?? entry.qrisAmount ?? 0;
    if (minNom !== null && amount < minNom) return false;
    if (maxNom !== null && amount > maxNom) return false;
    
    return true;
  });

  const totalSelisih = filtered.reduce((sum, e) => {
    if (e.status === 'BEDA' && e.selisih !== null) return sum + Math.abs(e.selisih);
    if (e.status === 'HILANG DI QRIS' && e.adminAmount !== null) return sum + e.adminAmount;
    if (e.status === 'HILANG DI ADMIN' && e.qrisAmount !== null) return sum + e.qrisAmount;
    return sum;
  }, 0);

  document.getElementById('totalRows').textContent = filtered.length;
  document.getElementById('totalSelisihDisplay').textContent = formatCurrency(totalSelisih);

  let tableHTML = `
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th class="text-right">Admin</th>
          <th class="text-right">QRIS</th>
          <th class="text-right">Selisih</th>
          <th class="text-center">Status</th>
        </tr>
      </thead>
      <tbody>
  `;

  if (filtered.length === 0) {
    tableHTML += `
      <tr>
        <td colspan="5" class="text-center" style="padding: 40px; color: #9ca3af;">
          <div style="font-size: 3rem; margin-bottom: 10px;">üîç</div>
          <div>Tidak ada data yang ditemukan</div>
          <div class="stat-subtitle mt-1">Sesuaikan filter atau masukkan data</div>
        </td>
      </tr>
    `;
  } else {
    filtered.forEach(entry => {
      let badge = '';
      if (entry.status === 'KLOP') {
        badge = '<span class="badge badge-success">‚úì KLOP</span>';
      } else if (entry.status === 'BEDA') {
        badge = '<span class="badge badge-warning">‚ö† BEDA</span>';
      } else if (entry.status === 'HILANG DI QRIS') {
        badge = '<span class="badge badge-error">‚úï HILANG DI QRIS</span>';
      } else {
        badge = '<span class="badge badge-error">‚úï HILANG DI ADMIN</span>';
      }

      tableHTML += `
        <tr>
          <td class="mono" style="font-weight: 500;">${toProperCase(entry.orderId)}</td>
          <td class="text-right mono">${entry.adminAmount !== null ? formatCurrency(entry.adminAmount) : '-'}</td>
          <td class="text-right mono">${entry.qrisAmount !== null ? formatCurrency(entry.qrisAmount) : '-'}</td>
          <td class="text-right mono">${entry.selisih !== null ? formatCurrency(entry.selisih) : '-'}</td>
          <td class="text-center">${badge}</td>
        </tr>
      `;
    });
  }

  tableHTML += '</tbody></table>';
  document.getElementById('tableContainer').innerHTML = tableHTML;
}

function exportCSV() {
  let csv = 'Order ID,Admin,QRIS,Selisih,Status\n';
  dashboardData.forEach(entry => {
    csv += `${toProperCase(entry.orderId)},${entry.adminAmount ?? '-'},${entry.qrisAmount ?? '-'},${entry.selisih ?? '-'},${entry.status}\n`;
  });

  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `dashboard-qris-${new Date().toISOString().split('T')[0]}.csv`;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
}

function exportPDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(16);
  doc.text('Dashboard Selisih QRIS TVTOTO', 14, 15);

  doc.setFontSize(10);
  let y = 25;

  const klop = dashboardData.filter(e => e.status === 'KLOP').length;
  const beda = dashboardData.filter(e => e.status === 'BEDA').length;
  const hilang = dashboardData.filter(e => e.status.includes('HILANG')).length;

  doc.text(`Total KLOP: ${klop}`, 14, y);
  y += 6;
  doc.text(`Total BEDA: ${beda}`, 14, y);
  y += 6;
  doc.text(`Total HILANG: ${hilang}`, 14, y);
  y += 10;

  doc.setFontSize(12);
  doc.text('Data Transaksi:', 14, y);
  y += 8;

  doc.setFontSize(8);
  dashboardData.slice(0, 50).forEach(entry => {
    const text = `${toProperCase(entry.orderId)} | Admin: ${entry.adminAmount ?? '-'} | QRIS: ${entry.qrisAmount ?? '-'} | Selisih: ${entry.selisih ?? '-'} | ${entry.status}`;
    doc.text(text, 14, y);
    y += 5;

    if (y > 280) {
      doc.addPage();
      y = 15;
    }
  });

  doc.save(`dashboard-qris-${new Date().toISOString().split('T')[0]}.pdf`);
}

initTheme();
</script>
</body>
</html>
